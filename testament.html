<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--  This file is generated by Nim. -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Favicon -->
<link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAUAAAAF////AP///wD///8A////AP///wD///8A////AP///wD///8A////AAAAAAIAAABbAAAAlQAAAKIAAACbAAAAmwAAAKIAAACVAAAAWwAAAAL///8A////AP///wD///8A////AAAAABQAAADAAAAAYwAAAA3///8A////AP///wD///8AAAAADQAAAGMAAADAAAAAFP///wD///8A////AP///wAAAACdAAAAOv///wD///8A////AP///wD///8A////AP///wD///8AAAAAOgAAAJ3///8A////AP///wAAAAAnAAAAcP///wAAAAAoAAAASv///wD///8A////AP///wAAAABKAAAAKP///wAAAABwAAAAJ////wD///8AAAAAgQAAABwAAACIAAAAkAAAAJMAAACtAAAAFQAAABUAAACtAAAAkwAAAJAAAACIAAAAHAAAAIH///8A////AAAAAKQAAACrAAAAaP///wD///8AAAAARQAAANIAAADSAAAARf///wD///8AAAAAaAAAAKsAAACk////AAAAADMAAACcAAAAnQAAABj///8A////AP///wAAAAAYAAAAGP///wD///8A////AAAAABgAAACdAAAAnAAAADMAAAB1AAAAwwAAAP8AAADpAAAAsQAAAE4AAAAb////AP///wAAAAAbAAAATgAAALEAAADpAAAA/wAAAMMAAAB1AAAAtwAAAOkAAAD/AAAA/wAAAP8AAADvAAAA3gAAAN4AAADeAAAA3gAAAO8AAAD/AAAA/wAAAP8AAADpAAAAtwAAAGUAAAA/AAAA3wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8AAADfAAAAPwAAAGX///8A////AAAAAEgAAADtAAAAvwAAAL0AAADGAAAA7wAAAO8AAADGAAAAvQAAAL8AAADtAAAASP///wD///8A////AP///wD///8AAAAAO////wD///8A////AAAAAIcAAACH////AP///wD///8AAAAAO////wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD4HwAA7/cAAN/7AAD//wAAoYUAAJ55AACf+QAAh+EAAAAAAADAAwAA4AcAAP5/AAD//wAA//8AAA=="/>
<link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4QQQEwksSS9ZWwAAAk1JREFUWMPtll2ITVEUx39nn/O7Y5qR8f05wtCUUr6ZIS++8pEnkZInPImneaCQ5METNdOkeFBKUhMPRIkHKfEuUZSUlGlKPN2TrgfncpvmnntnmlEyq1Z7t89/rf9a6+y99oZxGZf/XeIq61EdtgKXgdXA0xrYAvBjOIF1AI9zvjcC74BSpndrJPkBWDScTF8Aa4E3wDlgHbASaANmVqlcCnwHvgDvgVfAJ+AikAAvgfVZwLnSVZHZaOuKoQi3ZOMi4NkYkpe1p4J7A8BpYAD49hfIy/oqG0+hLomiKP2L5L+1ubn5115S+3OAn4EnwBlgMzCjyt6ZAnQCJ4A7wOs88iRJHvw50HoujuPBoCKwHWiosy8MdfZnAdcHk8dxXFJ3VQbQlCTJvRBCGdRbD4M6uc5glpY3eAihpN5S5w12diSEcCCEcKUO4ljdr15T76ur1FDDLIQQ3qv71EdDOe3Kxj3leRXyk+pxdWnFWod6Wt2bY3de3aSuUHcPBVimHs7mK9WrmeOF6lR1o9qnzskh2ar2qm1qizpfXaPeVGdlmGN5pb09qMxz1Xb1kLqgzn1RyH7JUXW52lr5e/Kqi9qpto7V1atuUzfnARrV7jEib1T76gG2qxdGmXyiekkt1GswPTtek0aBfJp6YySGBfWg2tPQ0FAYgf1stUfdmdcjarbYJEniKIq6gY/Aw+zWHAC+p2labGpqiorFYgGYCEzN7oQdQClN07O1/EfDyGgC0ALMBdYAi4FyK+4H3gLPsxfR1zRNi+NP7nH5J+QntnXe5B5mpfQAAAAASUVORK5CYII=">

<!-- Google fonts -->
<link href='https://fonts.googleapis.com/css?family=Lato:400,600,900' rel='stylesheet' type='text/css'/>
<link href='https://fonts.googleapis.com/css?family=Source+Code+Pro:400,500,600' rel='stylesheet' type='text/css'/>

<!-- CSS -->
<title>Testament</title>
<link rel="stylesheet" type="text/css" href="nimdoc.out.css">

<script type="text/javascript" src="dochack.js"></script>

<script type="text/javascript">
function main() {
  var pragmaDots = document.getElementsByClassName("pragmadots");
  for (var i = 0; i < pragmaDots.length; i++) {
    pragmaDots[i].onclick = function(event) {
      // Hide tease
      event.target.parentNode.style.display = "none";
      // Show actual
      event.target.parentNode.nextElementSibling.style.display = "inline";
    }
  }

  function switchTheme(e) {
      if (e.target.checked) {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
      } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
      }
  }

  const toggleSwitch = document.querySelector('.theme-switch input[type="checkbox"]');
  if (toggleSwitch !== null) {
    toggleSwitch.addEventListener('change', switchTheme, false);
  }

  var currentTheme = localStorage.getItem('theme');
  if (!currentTheme && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    currentTheme = 'dark';
  }
  if (currentTheme) {
    document.documentElement.setAttribute('data-theme', currentTheme);

    if (currentTheme === 'dark' && toggleSwitch !== null) {
      toggleSwitch.checked = true;
    }
  }
}

window.addEventListener('DOMContentLoaded', main);
</script>

</head>
<body>
<div class="document" id="documentId">
  <div class="container">
    <h1 class="title">Testament</h1>
    <div class="row">
  <div class="three columns">
  <div class="theme-switch-wrapper">
    <label class="theme-switch" for="checkbox">
      <input type="checkbox" id="checkbox" />
      <div class="slider round"></div>
    </label>
    &nbsp;&nbsp;&nbsp; <em>Dark Mode</em>
  </div>
  <div id="global-links">
    <ul class="simple-boot">
      <li><a href="manual.html">Manual</a></li>
      <li><a href="style_guide.html">Style guide</a></li>
      <li><a href="contributing.html">Contribution guide</a></li>
      <li><a href="lib.html">Standard library</a></li>
      <li><a href="theindex.html">Index</a></li>
      <li><a href="compiler/theindex.html">Compiler docs</a></li>
    </ul>
  </div>
  <div id="searchInputDiv">
    Search: <input type="text" id="searchInput"
      onkeyup="search()" />
  </div>
    <div class="search-groupby">
    Group by:
    <select onchange="groupBy(this.value)">
      <option value="section">Section</option>
      <option value="type">Type</option>
    </select>
  </div>

  <ul class="simple simple-toc" id="toc-list">
<li><a class="reference" id="test-files-location_toc" href="#test-files-location">Test files location</a></li>
<li><a class="reference" id="options_toc" href="#options">Options</a></li>
<li><a class="reference" id="running-a-single-test_toc" href="#running-a-single-test">Running a single test</a></li>
<li><a class="reference" id="html-reports_toc" href="#html-reports">HTML Reports</a></li>
<li><a class="reference" id="writing-tests_toc" href="#writing-tests">Writing Tests</a></li>
<ul class="simple"><li><a class="reference" id="writing-tests-test-execution-options_toc" href="#writing-tests-test-execution-options">Test execution options</a></li>
<li><a class="reference" id="writing-tests-compiler-output-assertions_toc" href="#writing-tests-compiler-output-assertions">Compiler output assertions</a></li>
<li><a class="reference" id="writing-tests-binary-output-assertions_toc" href="#writing-tests-binary-output-assertions">Binary output assertions</a></li>
</ul><li><a class="reference" id="reading-test-outputs_toc" href="#reading-test-outputs">Reading test outputs</a></li>
<ul class="simple"><li><a class="reference" id="reading-test-outputs-structured-mismatches_toc" href="#reading-test-outputs-structured-mismatches">Structured mismatches</a></li>
</ul><li><a class="reference" id="test-examples_toc" href="#test-examples">Test Examples</a></li>
<ul class="simple"><li><a class="reference" id="test-examples-structured-test-examples_toc" href="#test-examples-structured-test-examples">Structured test examples</a></li>
<li><a class="reference" id="test-examples-unstructured-old-style-test-examples_toc" href="#test-examples-unstructured-old-style-test-examples">Unstructured old, style test examples</a></li>
</ul>
</ul>

  </div>
  &nbsp;&nbsp;<a
href="https://github.com/nim-works/nimskull/tree/6d293518e73f023eef87cfd73c7b24cc285cbf29/doc/testament.rst#L1"
class="link-seesrc" target="_blank">Source</a>
&nbsp;&nbsp;<a href="https://github.com/nim-works/nimskull/edit/devel/doc/testament.rst#L1" class="link-seesrc" target="_blank" >Edit</a>

  <div class="nine columns" id="content">
  <div id="tocRoot"></div>
  
  <p class="module-desc"><p>Testament is a test runner for running tests in the development of  NimSkull itself. It offers process isolation for tests, it can generate statistics about test cases, supports multiple targets (C, C++, ObjectiveC, JavaScript, etc), simulated <a class="reference external" href="https://en.wikipedia.org/wiki/Dry_run_(testing)">Dry-Runs</a>, has logging, can generate HTML reports, skip tests from a file, and more.</p>

<h1><a class="toc-backref" id="test-files-location" href="#test-files-location">Test files location</a></h1><p>By default Testament looks for test files on <tt class="docutils literal"><span class="pre">&quot;./tests/**/*.nim&quot;</span></tt>. The default working directory path can be changed using <tt class="docutils literal"><span class="pre option">--directory:&quot;folder/subfolder/&quot;</span></tt>.</p>
<p>Testament uses the <tt class="docutils literal"><span class="pre"><span class="program">nim</span></span></tt> compiler on <tt class="docutils literal"><span class="pre"><span class="Identifier">PATH</span></span></tt>. You can change that using <tt class="docutils literal"><span class="pre option">--nim:&quot;folder/subfolder/nim&quot;</span></tt>. Running JavaScript tests with <tt class="docutils literal"><span class="pre option">--targets:&quot;js&quot;</span></tt> requires a working NodeJS on <tt class="docutils literal"><span class="pre"><span class="Identifier">PATH</span></span></tt>.</p>

<h1><a class="toc-backref" id="options" href="#options">Options</a></h1><div class="option-list"><div class="option-list-item odd"><div class="option-list-label"><tt><span class="option">--print</span></tt></div><div class="option-list-description">Also print results to the console</div></div>
<div class="option-list-item"><div class="option-list-label"><tt><span class="option">--simulate</span></tt></div><div class="option-list-description">See what tests would be run but don't run them (for debugging)</div></div>
<div class="option-list-item odd"><div class="option-list-label"><tt><span class="option">--failing</span></tt></div><div class="option-list-description">Only show failing/ignored tests</div></div>
<div class="option-list-item"><div class="option-list-label"><tt><span class="option">--targets:&quot;c cpp js objc&quot;</span></tt></div><div class="option-list-description">Run tests for specified targets (default: all)</div></div>
<div class="option-list-item odd"><div class="option-list-label"><tt><span class="option">--nim:path</span></tt></div><div class="option-list-description">Use a particular nim executable (default: $PATH/nim)</div></div>
<div class="option-list-item"><div class="option-list-label"><tt><span class="option">--directory:dir</span></tt></div><div class="option-list-description">Change to directory dir before reading the tests or doing anything else.</div></div>
<div class="option-list-item odd"><div class="option-list-label"><tt><span class="option">--colors:on|off</span></tt></div><div class="option-list-description">Turn messages coloring on|off.</div></div>
<div class="option-list-item"><div class="option-list-label"><tt><span class="option">--backendLogging:on|off</span></tt></div><div class="option-list-description">Disable or enable backend logging. By default turned on.</div></div>
<div class="option-list-item odd"><div class="option-list-label"><tt><span class="option">--skipFrom:file</span></tt></div><div class="option-list-description">Read tests to skip from <tt class="docutils literal"><span class="pre">file</span></tt> - one test per line, # comments ignored</div></div>
</div>
<h1><a class="toc-backref" id="running-a-single-test" href="#running-a-single-test">Running a single test</a></h1><p>This is a minimal example to understand the basics, not very useful for production, but easy to understand:</p>
<pre class="listing"><span class="Prompt">$ </span><span class="program">mkdir</span> <span class="option">tests</span>
<span class="Prompt">$ </span><span class="program">echo</span> <span class="option">&quot;assert 42 == 42&quot;</span> <span class="option">&gt;</span> <span class="Identifier">tests/test0.nim</span>
<span class="Prompt">$ </span><span class="program">testament</span> <span class="option">run</span> <span class="Identifier">test0.nim</span>
<span class="ProgramOutput">PASS: tests/test0.nim C                                    ( 0.2 sec)</span>
<span class="Prompt">$ </span><span class="program">testament</span> <span class="option">r</span> <span class="option">test0</span>
<span class="ProgramOutput">PASS: tests/test0.nim C                                    ( 0.2 sec)</span></pre>
<h1><a class="toc-backref" id="html-reports" href="#html-reports">HTML Reports</a></h1><p>Generate HTML Reports <tt class="docutils literal"><span class="pre">testresults.html</span></tt> from tests, you have to run at least 1 test <em>before</em> generating a report:</p>
<pre class="listing"><span class="Prompt">$ </span><span class="program">testament</span> <span class="option">html</span></pre>
<h1><a class="toc-backref" id="writing-tests" href="#writing-tests">Writing Tests</a></h1><p><tt class="docutils literal"><span class="pre">description</span></tt> - textual description of the test. <strong>Highly</strong> recomended to add one - in the future testament might use this to provide better teardown reports, or notify about <tt class="docutils literal"><span class="pre">knownIssue</span></tt> state transitions.</p>

<h2><a class="toc-backref" id="writing-tests-test-execution-options" href="#writing-tests-test-execution-options">Test execution options</a></h2><ul class="simple"><li><tt class="docutils literal"><span class="pre">action</span></tt> - What action(s) to expect completion on.<ul class="simple"><li><tt class="docutils literal"><span class="pre">&quot;compile&quot;</span></tt>: expect successful compilation</li>
<li><tt class="docutils literal"><span class="pre">&quot;run&quot;</span></tt>: expect successful compilation and execution</li>
<li><tt class="docutils literal"><span class="pre">&quot;reject&quot;</span></tt>: expect failed compilation. The &quot;reject&quot; action can catch <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">error</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> pragmas but not <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">fatal</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> pragmas because <tt class="docutils literal"><span class="pre"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">fatal</span><span class="Operator">.</span><span class="Punctuation">}</span></span></tt> pragmas guarantee that compilation will be aborted.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">batchable</span></tt>: Can be run in batch mode, or not.</li>
<li><tt class="docutils literal"><span class="pre">joinable</span></tt>: Can be run Joined with other tests to run all togheter, or not. Defaults to <tt class="docutils literal"><span class="pre"><span class="Identifier">true</span></span></tt></li>
<li><tt class="docutils literal"><span class="pre">timeout</span></tt> Timeout seconds to run the test. Fractional values are supported.</li>
<li><p><tt class="docutils literal"><span class="pre">cmd</span></tt>: Command used to run the test. If left out or an empty string is provided, the command is taken to be: <tt class="docutils literal"><span class="pre">&quot;nim $target --hints:on -d:testing --nimblePath:build/deps/pkgs $options $file&quot;</span></tt> You can use the <tt class="docutils literal"><span class="pre">$target</span></tt>, <tt class="docutils literal"><span class="pre">$options</span></tt>, and <tt class="docutils literal"><span class="pre">$file</span></tt> placeholders in your own command, too.</p>
<p>example: <tt class="docutils literal"><span class="pre">&quot;nim c -r $file&quot;</span></tt></p>
</li>
<li><tt class="docutils literal"><span class="pre">targets</span></tt> supported backend compilation targets for test into (c, cpp, objc, js). Targets can be excluded via a <tt class="docutils literal"><span class="pre"><span class="Operator">!</span></span></tt>, eg: <tt class="docutils literal"><span class="pre"><span class="Operator">!</span><span class="Identifier">js</span></span></tt> to exclude js. Additionally, a <tt class="docutils literal"><span class="pre"><span class="Identifier">native</span></span></tt> target is supported in order to use the same target used for the compiler itself.</li>
<li><tt class="docutils literal"><span class="pre">matrix</span></tt> flags with which to run the test, delimited by <tt class="docutils literal"><span class="pre"><span class="Punctuation">;</span></span></tt></li>
<li><tt class="docutils literal"><span class="pre">disabled</span></tt> Conditions that will skip this test. Use of multiple &quot;disabled&quot; clauses is permitted.<pre class="listing"><span class="Identifier">disabled</span><span class="Punctuation">:</span> <span class="StringLit">&quot;bsd&quot;</span>   <span class="Comment"># Can disable OSes...</span>
<span class="Identifier">disabled</span><span class="Punctuation">:</span> <span class="StringLit">&quot;win&quot;</span>
<span class="Identifier">disabled</span><span class="Punctuation">:</span> <span class="StringLit">&quot;32bit&quot;</span> <span class="Comment"># ...or architectures</span>
<span class="Identifier">disabled</span><span class="Punctuation">:</span> <span class="StringLit">&quot;i386&quot;</span>
<span class="Identifier">disabled</span><span class="Punctuation">:</span> <span class="Identifier">true</span>    <span class="Comment"># ...or can disable the test entirely</span></pre></li>
<li><tt class="docutils literal"><span class="pre">knownIssue</span></tt></li>
</ul>

<h2><a class="toc-backref" id="writing-tests-compiler-output-assertions" href="#writing-tests-compiler-output-assertions">Compiler output assertions</a></h2><ul class="simple"><li><tt class="docutils literal"><span class="pre">errormsg</span></tt>: Error message the test should print, if any.</li>
<li><dl class="docutils"><dt><tt class="docutils literal"><span class="pre">nimout</span></tt> Each line in the string given here appears in the same order</dt>
<dd>in the compiler output, but there may be more lines that appear before, after, or in between them. Note that specifying multiline strings for testament spec inside of the <tt class="docutils literal"><span class="pre"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;</span></span></tt> section requires using triple single quotes <tt class="docutils literal"><span class="pre"><span class="CharLit">'</span></span></tt><pre class="listing"><span class="Identifier">nimout</span><span class="Punctuation">:</span> <span class="CharLit">''</span><span class="CharLit">'</span>
<span class="Identifier">a</span> <span class="Identifier">very</span> <span class="Identifier">long</span><span class="Punctuation">,</span>
<span class="Identifier">multi</span><span class="Operator">-</span><span class="Identifier">line</span>
<span class="Identifier">string</span><span class="CharLit">''</span><span class="CharLit">'</span></pre></dd>
</dl>
</li>
<li><tt class="docutils literal"><span class="pre">nimoutFull</span></tt>: true/false, controls whether full compiler output must be asserted, or only presence of error messages</li>
<li><tt class="docutils literal"><span class="pre">maxcodesize</span></tt>: Max side of the resulting codegen file for a test</li>
</ul>
<p>In addition to <tt class="docutils literal"><span class="pre">nimout</span></tt> message annotations testament also allows to supply hints, warnings and error messages directly in the source code using specially formatted comments, starting with <tt class="docutils literal"><span class="pre">#[tt.</span></tt>. For example, if you want to assert that error message is genrated, you can write a following test:</p>
<pre class="listing"><span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">error</span><span class="Punctuation">:</span> <span class="StringLit">&quot;Error message&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="LongComment">#[tt.Error
  ^ &quot;Error message&quot;
]#</span></pre><p>File, line and column information are automatically inferred from the position of the <tt class="docutils literal"><span class="pre">^</span></tt> marker in the annotation body.</p>

<h2><a class="toc-backref" id="writing-tests-binary-output-assertions" href="#writing-tests-binary-output-assertions">Binary output assertions</a></h2><ul class="simple"><li><tt class="docutils literal"><span class="pre">exitcode</span></tt>: The exit code that the test is expected to return. Typically, the default value of 0 is fine. Note that if the test will be run by valgrind, then the test will exit with either a code of 0 on success or 1 on failure.</li>
<li><tt class="docutils literal"><span class="pre">output</span></tt>, <tt class="docutils literal"><span class="pre">outsub</span></tt>: Provide an <tt class="docutils literal"><span class="pre"><span class="Identifier">output</span></span></tt> string to assert that the test prints to standard out exactly the expected string. Provide an <tt class="docutils literal"><span class="pre"><span class="Identifier">outputsub</span></span></tt> string to assert that the string given here is a substring of the standard out output of the test.</li>
<li><tt class="docutils literal"><span class="pre">sortoutput</span></tt> Whether to sort the output lines before comparing them to the desired output.</li>
<li><tt class="docutils literal"><span class="pre">input</span></tt>: this is the Standard Input the test should take, if any.</li>
<li><dl class="docutils"><dt><tt class="docutils literal"><span class="pre">valgrind</span></tt> On Linux 64-bit machines, whether to use Valgrind to check</dt>
<dd>for bad memory accesses or memory leaks. On other architectures, the test will be run as-is, without Valgrind.<ul class="simple"><li><tt class="docutils literal"><span class="pre">true</span></tt>: run the test with Valgrind</li>
<li><tt class="docutils literal"><span class="pre">false</span></tt>: run the without Valgrind</li>
<li><tt class="docutils literal"><span class="pre">&quot;leaks&quot;</span></tt>: run the test with Valgrind, but do not check for memory leaks</li>
</ul>
</dd>
</dl>
</li>
</ul>
<ul class="simple"><li>As you can see the &quot;Spec&quot; is just a <tt class="docutils literal"><span class="pre"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot; &quot;&quot;&quot;</span></span></tt>.</li>
<li>Spec has sane defaults, so you don't need to provide them all, any simple assert will work just fine.</li>
<li><a class="reference external" href="https://github.com/nim-works/nimskull/blob/devel/testament/specs.nim#L238">This is not the full spec of Testament, check the Testament Spec on GitHub, see parseSpec().</a></li>
<li><a class="reference external" href="https://github.com/nim-works/nimskull/tree/devel/tests">Nim itself uses Testament, so there are plenty of test examples.</a></li>
<li><a class="reference external" href="https://github.com/nim-works/nimskull/blob/9a110047cbe2826b1d4afe63e3a1f5a08422b73f/tests/effects/teffects1.nim">Testament supports inlined error messages on tests, basically comments with the expected error directly on the code.</a></li>
</ul>

<h1><a class="toc-backref" id="reading-test-outputs" href="#reading-test-outputs">Reading test outputs</a></h1><p>Testament supports two different modes of interaction with the compiler - structured and unstructured. Unstructured interaction mode (currently default) allows user to specify exact compiler output that should be produced by the test and then compares it based on <tt class="docutils literal"><span class="pre">nimoutFull</span></tt> configuration options.</p>
<p>If there is a mismatch, a failure message is generated, showing the diffs.</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
nimout: '''
Expected unstructured compiler output
'''
&quot;&quot;&quot;</span>

<span class="Keyword">static</span><span class="Punctuation">:</span>
  <span class="Identifier">echo</span> <span class="StringLit">&quot;Expected unstructured output&quot;</span></pre><p>In that case comparison is performed between two regular string blocks. Since each entry is not wide enough (not wider than current terminal) they are printed side-by side to make it easier to spot the difference. Mismatches are also highlighted in the terminal.</p>
<pre class="listing">- Expected unstructured compiler output   + Expected unstructured output
-                                         ?</pre><div class="admonition admonition-info"><span class="admonition-info-text"><b>Note:</b></span>
expected (on the left) outout has two lines deleted - trailing <tt class="docutils literal"><span class="pre">'''</span></tt> in the testament spec is placed on the next line, so it is considered to be a string literal of <tt class="docutils literal"><span class="pre">&quot;Expected unstructured compiler output\n&quot;</span></tt></div>

<h2><a class="toc-backref" id="reading-test-outputs-structured-mismatches" href="#reading-test-outputs-structured-mismatches">Structured mismatches</a></h2><p>In structured output mode, the compiler writes out S-expressions for each output diagnostic entry, one per line.</p>
<p>If testament is used in structured mode, all expected compiler reports - both inline and written in <tt class="docutils literal"><span class="pre">nimout</span></tt> are collected in a single list that is matched against produced output directly. The failure message shows the best possible mismatch annotations for the given output. For example, given the test below, testament output will contain two mismatches for both failures.</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
nimoutFormat: sexp
cmd: &quot;nim c --msgFormat=sexp --skipUserCfg --hints=on --hint=all:off --hint=User:on --filenames:canonical $file&quot;
nimout: '''
(User :str &quot;User Hint&quot; :location (&quot;tfile.nim&quot; 8 _))
'''
&quot;&quot;&quot;</span>

<span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">hint</span><span class="Punctuation">:</span> <span class="StringLit">&quot;User hint&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span>

<span class="Punctuation">{</span><span class="Operator">.</span><span class="Identifier">hint</span><span class="Punctuation">:</span> <span class="StringLit">&quot;Another hint&quot;</span><span class="Operator">.</span><span class="Punctuation">}</span> <span class="LongComment">#[tt.Hint
      ^ (User :str &quot;Another hint&quot;) ]#</span></pre><p>Both inline and <tt class="docutils literal"><span class="pre">nimout</span></tt> annotations are compared. Both have errors, so the best possible mapping is presented as an error ('best' because it is generally impossible to find correct place to insert inline annotation somewhere in <tt class="docutils literal"><span class="pre">nimout</span></tt>, without potentially messing up ordering. Unstructured output simply sets inline annotations to a higher priority and searches for them first)</p>
<pre class="listing"><span class="Identifier">Expected</span> <span class="Identifier">inline</span> <span class="Identifier">Hint</span> <span class="Identifier">annotation</span> <span class="Identifier">at</span> <span class="Identifier">tfile</span><span class="Operator">.</span><span class="Identifier">nim</span><span class="Punctuation">(</span><span class="DecNumber">11</span><span class="Punctuation">,</span> <span class="DecNumber">7</span><span class="Punctuation">)</span><span class="Punctuation">:</span>

<span class="Operator">-</span> <span class="Punctuation">(</span><span class="Identifier">User</span> <span class="Punctuation">:</span><span class="Identifier">location</span> <span class="Punctuation">(</span><span class="StringLit">&quot;tfile.nim&quot;</span> <span class="DecNumber">11</span> <span class="DecNumber">7</span><span class="Punctuation">)</span> <span class="Punctuation">:</span><span class="Identifier">severity</span> <span class="Identifier">Hint</span> <span class="Punctuation">:</span><span class="Identifier">str</span> <span class="StringLit">&quot;Another hint&quot;</span><span class="Punctuation">)</span>

<span class="Identifier">Given</span><span class="Punctuation">:</span>

<span class="Operator">+</span> <span class="Punctuation">(</span><span class="Identifier">User</span> <span class="Punctuation">:</span><span class="Identifier">location</span> <span class="Punctuation">(</span><span class="StringLit">&quot;tfile.nim&quot;</span> <span class="DecNumber">11</span> <span class="DecNumber">6</span><span class="Punctuation">)</span> <span class="Punctuation">:</span><span class="Identifier">severity</span> <span class="Identifier">Hint</span> <span class="Punctuation">:</span><span class="Identifier">str</span> <span class="StringLit">&quot;Another hint&quot;</span><span class="Punctuation">)</span>
  
  
  <span class="Punctuation">:</span><span class="Identifier">location</span><span class="Punctuation">[</span><span class="DecNumber">2</span><span class="Punctuation">]</span> <span class="Identifier">expected</span> <span class="DecNumber">7</span><span class="Punctuation">,</span> <span class="Identifier">but</span> <span class="Identifier">got</span> <span class="DecNumber">6</span> <span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">7</span><span class="Operator">-&gt;</span><span class="DecNumber">6</span><span class="Punctuation">]</span><span class="Punctuation">)</span>

<span class="Identifier">Expected</span><span class="Punctuation">:</span>

<span class="Operator">-</span> <span class="Punctuation">(</span><span class="Identifier">User</span> <span class="Punctuation">:</span><span class="Identifier">location</span> <span class="Punctuation">(</span><span class="StringLit">&quot;tfile.nim&quot;</span> <span class="DecNumber">8</span> <span class="Identifier">_</span><span class="Punctuation">)</span> <span class="Punctuation">:</span><span class="Identifier">str</span> <span class="StringLit">&quot;User Hint&quot;</span><span class="Punctuation">)</span>

<span class="Identifier">Given</span><span class="Punctuation">:</span>

<span class="Operator">+</span> <span class="Punctuation">(</span><span class="Identifier">User</span> <span class="Punctuation">:</span><span class="Identifier">location</span> <span class="Punctuation">(</span><span class="StringLit">&quot;tfile.nim&quot;</span> <span class="DecNumber">9</span> <span class="DecNumber">6</span><span class="Punctuation">)</span> <span class="Punctuation">:</span><span class="Identifier">severity</span> <span class="Identifier">Hint</span> <span class="Punctuation">:</span><span class="Identifier">str</span> <span class="StringLit">&quot;User hint&quot;</span><span class="Punctuation">)</span>
  
  
  <span class="Punctuation">:</span><span class="Identifier">str</span> <span class="Identifier">expected</span> <span class="StringLit">&quot;User Hint&quot;</span><span class="Punctuation">,</span> <span class="Identifier">but</span> <span class="Identifier">got</span> <span class="StringLit">&quot;User hint&quot;</span> <span class="Punctuation">(</span><span class="StringLit">&quot;User [Hint&quot;</span><span class="Operator">-&gt;</span><span class="RawData">hint&quot;])</span>
  <span class="Punctuation">:</span><span class="Identifier">location</span><span class="Punctuation">[</span><span class="DecNumber">1</span><span class="Punctuation">]</span> <span class="Identifier">expected</span> <span class="DecNumber">8</span><span class="Punctuation">,</span> <span class="Identifier">but</span> <span class="Identifier">got</span> <span class="DecNumber">9</span> <span class="Punctuation">(</span><span class="Punctuation">[</span><span class="DecNumber">8</span><span class="Operator">-&gt;</span><span class="DecNumber">9</span><span class="Punctuation">]</span><span class="Punctuation">)</span></pre><p>Compiler printed reports</p>
<pre class="listing"><span class="Punctuation">(</span><span class="Identifier">User</span> <span class="Punctuation">:</span><span class="Identifier">severity</span> <span class="Identifier">Hint</span> <span class="Punctuation">:</span><span class="Identifier">str</span> <span class="StringLit">&quot;User hint&quot;</span> <span class="Punctuation">:</span><span class="Identifier">location</span> <span class="Punctuation">(</span><span class="StringLit">&quot;tfile.nim&quot;</span> <span class="DecNumber">8</span> <span class="DecNumber">6</span><span class="Punctuation">)</span><span class="Punctuation">)</span>
<span class="Punctuation">(</span><span class="Identifier">User</span> <span class="Punctuation">:</span><span class="Identifier">severity</span> <span class="Identifier">Hint</span> <span class="Punctuation">:</span><span class="Identifier">str</span> <span class="StringLit">&quot;Another hint&quot;</span> <span class="Punctuation">:</span><span class="Identifier">location</span> <span class="Punctuation">(</span><span class="StringLit">&quot;tfile.nim&quot;</span> <span class="DecNumber">10</span> <span class="DecNumber">6</span><span class="Punctuation">)</span><span class="Punctuation">)</span></pre><p>And they were matched against full list of expected entries. For the first entry there is a mismatch in <tt class="docutils literal"><span class="pre">:location[2]</span></tt>, and for second one there is a string value error (in <tt class="docutils literal"><span class="pre">:str</span></tt>) and another mismatch in location data.</p>
<p>To make it easier to spot differences between string values the inline diff is added for the message.</p>

<h1><a class="toc-backref" id="test-examples" href="#test-examples">Test Examples</a></h1>
<h2><a class="toc-backref" id="test-examples-structured-test-examples" href="#test-examples-structured-test-examples">Structured test examples</a></h2>
<h2><a class="toc-backref" id="test-examples-unstructured-old-style-test-examples" href="#test-examples-unstructured-old-style-test-examples">Unstructured old, style test examples</a></h2><p>Expected to fail:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
  errormsg: &quot;undeclared identifier: 'not_defined'&quot;
&quot;&quot;&quot;</span>
<span class="Identifier">assert</span> <span class="Identifier">not_defined</span> <span class="Operator">==</span> <span class="StringLit">&quot;not_defined&quot;</span><span class="Punctuation">,</span> <span class="StringLit">&quot;not_defined is not defined&quot;</span></pre><p>Non-Zero exit code:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
  exitcode: 1
&quot;&quot;&quot;</span>
<span class="Identifier">quit</span> <span class="StringLit">&quot;Non-Zero exit code&quot;</span><span class="Punctuation">,</span> <span class="DecNumber">1</span></pre><p>Standard output checking:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
  
  output: '''
0
1
2
3
4
5
'''

&quot;&quot;&quot;</span>
<span class="Keyword">for</span> <span class="Identifier">i</span> <span class="Keyword">in</span> <span class="FloatNumber">0.</span><span class="Operator">.</span><span class="DecNumber">5</span><span class="Punctuation">:</span> <span class="Identifier">echo</span> <span class="Identifier">i</span></pre><p>JavaScript tests:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
  targets: &quot;js&quot;
&quot;&quot;&quot;</span>
<span class="Keyword">when</span> <span class="Identifier">defined</span><span class="Punctuation">(</span><span class="Identifier">js</span><span class="Punctuation">)</span><span class="Punctuation">:</span>
  <span class="Keyword">import</span> <span class="Identifier">std</span><span class="Operator">/</span><span class="Identifier">jsconsole</span>
  <span class="Identifier">console</span><span class="Operator">.</span><span class="Identifier">log</span><span class="Punctuation">(</span><span class="StringLit">&quot;My Frontend Project&quot;</span><span class="Punctuation">)</span></pre><p>Compile-time tests:</p>
<pre class="listing"><span class="Keyword">discard</span> <span class="LongStringLit">&quot;&quot;&quot;
  action: &quot;compile&quot;
&quot;&quot;&quot;</span>
<span class="Keyword">static</span><span class="Punctuation">:</span> <span class="Identifier">assert</span> <span class="DecNumber">9</span> <span class="Operator">==</span> <span class="DecNumber">9</span><span class="Punctuation">,</span> <span class="StringLit">&quot;Compile time assert&quot;</span></pre><p>Tests without Spec:</p>
<pre class="listing"><span class="Identifier">assert</span> <span class="DecNumber">1</span> <span class="Operator">==</span> <span class="DecNumber">1</span></pre><p>See also:</p>
<ul class="simple"><li><a class="reference external" href="unittest.html">Unittest</a></li>
</ul>
</p>
  
  </div>
</div>

    <div class="row">
      <div class="twelve-columns footer">
        <span class="nim-sprite"></span>
        <br/>
        <small style="color: var(--hint);">Made with Nim. Generated: 2022-10-19 00:00:00 UTC</small>
      </div>
    </div>
  </div>
</div>
</body>
</html>
